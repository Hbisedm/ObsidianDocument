import{_ as s,c as n,o as a,a as p}from"./app.e5db1f59.js";const i=JSON.parse('{"title":"webpack打包器运行时分析","description":"","frontmatter":{"title":"webpack打包器运行时分析","date":"2022-05-26T12:42:26.000Z","tags":["工程化","webpack"],"excerpt":"打包分析过程."},"headers":[{"level":2,"title":"webpack","slug":"webpack","link":"#webpack","children":[{"level":3,"title":"代码调试","slug":"代码调试","link":"#代码调试","children":[]}]}],"relativePath":"工作区/工程化/打包工具/webpack/webpack打包器运行时分析.md"}'),l={name:"工作区/工程化/打包工具/webpack/webpack打包器运行时分析.md"},o=p(`<p>#工程化</p><h1 id="打包器运行时分析" tabindex="-1">打包器运行时分析 <a class="header-anchor" href="#打包器运行时分析" aria-hidden="true">#</a></h1><h2 id="webpack" tabindex="-1">webpack <a class="header-anchor" href="#webpack" aria-hidden="true">#</a></h2><p>目录：</p><p><img src="https://raw.githubusercontent.com/Hbisedm/my-blob-picGo/main/img/202205292222678.png" alt="image-20220529222235641"></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// src/sum.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">   </span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// src/index.js </span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> sum </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./sum</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">sum</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// webpack.config.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">mode</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">none</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">iife</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">pathinfo</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">verbose</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>打包后的<code>main.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">/******/</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> __webpack_modules__ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ([</span></span>
<span class="line"><span style="color:#676E95;">/* 0 */</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#676E95;">/* 1 */</span></span>
<span class="line"><span style="color:#676E95;">/*!********************!*\\</span></span>
<span class="line"><span style="color:#676E95;">  !*** ./src/sum.js ***!</span></span>
<span class="line"><span style="color:#676E95;">  \\********************/</span></span>
<span class="line"><span style="color:#676E95;">/*! unknown exports (runtime-defined) */</span></span>
<span class="line"><span style="color:#676E95;">/*! runtime requirements: module */</span></span>
<span class="line"><span style="color:#676E95;">/*! CommonJS bailout: module.exports is used directly at 1:0-14 */</span></span>
<span class="line"><span style="color:#676E95;">/***/</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">module</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">   </span><span style="color:#82AAFF;">sum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">x</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/***/</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#A6ACCD;"> ])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">/************************************************************************/</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// The module cache</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> __webpack_module_cache__ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// The require function</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">__webpack_require__</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">moduleId</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 	</span><span style="color:#676E95;">// Check if module is in cache</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 	</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__webpack_module_cache__</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">moduleId</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 	</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 		</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 	</span><span style="color:#676E95;">// Create a new module (and put it into the cache)</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 	</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__webpack_module_cache__</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">moduleId</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 		</span><span style="color:#676E95;">// no module.id needed</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 		</span><span style="color:#676E95;">// no module.loaded needed</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 		exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 	</span><span style="color:#676E95;">// Execute the module function</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 	</span><span style="color:#A6ACCD;">__webpack_modules__</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">moduleId</span><span style="color:#F07178;">](</span><span style="color:#89DDFF;">module,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.exports,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__webpack_require__</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 	</span><span style="color:#676E95;">// Return the exports of the module</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> 	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.exports;</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">/******/</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;">/************************************************************************/</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> __webpack_exports__ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"><span style="color:#676E95;">// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;">/*!**********************!*\\</span></span>
<span class="line"><span style="color:#676E95;">  !*** ./src/index.js ***!</span></span>
<span class="line"><span style="color:#676E95;">  \\**********************/</span></span>
<span class="line"><span style="color:#676E95;">/*! unknown exports (runtime-defined) */</span></span>
<span class="line"><span style="color:#676E95;">/*! runtime requirements: __webpack_require__ */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">__webpack_require__</span><span style="color:#F07178;">(</span><span style="color:#676E95;">/*! ./sum */</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">sum</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><code>webpack</code> 的 runtime，也就是 webpack 最后生成的代码，做了以下三件事:</p><ol><li><code>__webpack_modules__</code>: <strong>维护一个所有模块的数组</strong>。将入口模块解析为 AST，根据 AST 深度优先搜索所有的模块，并构建出这个模块数组。每个模块都由一个包裹函数 <code>(module, module.exports, __webpack_require__)</code> 对模块进行包裹构成。</li><li><code>__webpack_require__(moduleId)</code>: <strong>手动实现加载一个模块</strong>。对已加载过的模块进行缓存，对未加载过的模块，执行 id 定位到 <code>__webpack_modules__</code> 中的包裹函数，执行并返回 <code>module.exports</code>，并<strong>缓存</strong></li><li><code>__webpack_require__(0)</code>: 运行第一个模块，即运行入口模块</li></ol><p>另外，当涉及到多个 chunk 的打包方式中，比如 <code>code spliting</code>，webpack 中会有 <code>jsonp</code> 加载 chunk 的运行时代码。</p><p>对 <code>webpack runtime</code> 做进一步的精简，代码如下</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> __webpack_modules__ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> __webpack_require__ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">m</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__webpack_modules__</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">](</span><span style="color:#89DDFF;">module,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__webpack_require__</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.exports;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">__webpack_require__</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="代码调试" tabindex="-1">代码调试 <a class="header-anchor" href="#代码调试" aria-hidden="true">#</a></h3><p><img src="https://raw.githubusercontent.com/Hbisedm/my-blob-picGo/main/img/202205292227418.png" alt="image-20220529222701377"></p><p>打个断点，运行<code>node main.js</code> 进行代码调试更加好分析代码。</p><p><img src="https://raw.githubusercontent.com/Hbisedm/my-blob-picGo/main/img/202205292227086.png" alt="image-20220529222739052"></p>`,17),e=[o];function c(t,r,y,F,D,C){return a(),n("div",null,e)}const d=s(l,[["render",c]]);export{i as __pageData,d as default};
